(function($){'use strict';var f=function(a,b){if('undefined'!==typeof console&&'undefined'!==typeof console.log){console.log(a,b||{})}},Pagelet=function(c,d){var e=0,that=this,debug=function(a,b){if(that.options.debug){f('BigPipe pagelet "'+that.options.id+'": '+a,b||that)}},setState=function(a){that.state=a;debug('State is now '+that.state);that.options.onStateChange(that.state,that)},onComplete=function(){setState(5);c.ping()},ping=function(){e+=1;if(that.options.js.length===e){onComplete()}};this.options=d;this.state=null;this.target=$('[data-pagelet='+this.options.id+']');this.postload=function(){if(0===that.options.js.length){onComplete()}else{setState(4);$.each(that.options.js,function(){debug('Postloading "'+this+'"');$.ajax({dataType:'script',url:this,complete:function(){ping()}})})}};this.start=function(){if(0!==that.options.css.length){setState(1);$.each(that.options.css,function(){debug('Preloading "'+this+'"');if(document.createStyleSheet){document.createStyleSheet(this)}else{$('<link />',{href:this,rel:'stylesheet',type:'text/css'}).appendTo('head')}})}setState(2);that.target.html(that.options.html);setState(3)};setState(0)},BigPipe=function(c){var d=[],pinged=0,that=this,debug=function(a,b){if(that.options.debug){f('BigPipe: '+a,b||that)}},setState=function(a){that.state=a;debug('State is now '+that.state);that.options.onStateChange(that.state,that)},onComplete=function(){setState(3)};this.options=c;this.state=null;this.onArrive=function(a){setState(1);debug('Pagelet arrived',a);var b=new Pagelet(that,$.extend({},that.options,$.BigPipe.pagelet,a));d.push(b);b.start();return b};this.ping=function(){pinged+=1;if(d.length===pinged){onComplete()}};setState(0);$(function(){if(0===d.length){onComplete()}else{setState(2);$.each(d,function(){this.postload()})}})};$.BigPipe=function(a){return new BigPipe($.extend({},$.BigPipe.options,a))};$.BigPipe.options={debug:false,onStateChange:function(){}};$.BigPipe.pagelet={id:'pagelet',html:'',js:[],css:[],onStateChange:function(){}}}(jQuery));